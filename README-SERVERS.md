# Управление серверами приложения Reposter

Этот набор скриптов позволяет легко управлять всеми серверами приложения в фоновом режиме.

## Скрипты

### 1. `start-servers.sh` - Запуск всех серверов
Запускает все необходимые серверы в фоновом режиме:
- **Backend сервер** (Express.js) на порту 5000
- **Frontend сервер** (Vite + React) на порту 3000
- **База данных** (SQLite) автоматически запускается с сервером

**Использование:**
```bash
./start-servers.sh
```

**Что делает скрипт:**
- Проверяет наличие необходимых директорий и зависимостей
- Останавливает существующие процессы на портах 3000 и 5000
- Устанавливает зависимости (если не установлены)
- Запускает серверы в фоновом режиме
- Создает PID файлы для управления процессами
- Сохраняет логи в директорию `logs/`

### 2. `stop-servers.sh` - Остановка всех серверов
Останавливает все запущенные серверы.

**Использование:**
```bash
./stop-servers.sh
```

**Что делает скрипт:**
- Останавливает процессы по PID файлам
- Дополнительно останавливает процессы по портам
- Очищает временные файлы
- Удаляет PID файлы

### 3. `status-servers.sh` - Проверка статуса серверов
Показывает текущий статус всех серверов.

**Использование:**
```bash
./status-servers.sh
```

**Что показывает скрипт:**
- Статус backend сервера (порт 5000)
- Статус frontend сервера (порт 3000)
- Использование ресурсов
- Последние строки логов
- Информацию о процессах

### 4. `restart-servers.sh` - Перезапуск всех серверов
Останавливает и перезапускает все серверы.

**Использование:**
```bash
./restart-servers.sh
```

**Что делает скрипт:**
- Останавливает все запущенные серверы
- Запускает их заново
- Показывает текущий статус

### 5. `fix-posts-progress.sh` - Диагностика проблем с постами
Диагностирует и исправляет проблемы с загрузкой постов и прогрессом задач.

**Использование:**
```bash
./fix-posts-progress.sh
```

**Что делает скрипт:**
- Проверяет статус серверов
- Анализирует базу данных
- Проверяет настройки фильтров
- Принудительно синхронизирует кэш (опционально)

### 6. `fix-progress.sh` - Исправление прогресса задач
Автоматически исправляет прогресс всех активных задач.

**Использование:**
```bash
./fix-progress.sh
```

**Что делает скрипт:**
- Подсчитывает общее количество постов в кэше
- Подсчитывает количество опубликованных постов
- Обновляет прогресс задач в базе данных

## Структура файлов

После запуска создается следующая структура:

```
reposter_2/
├── logs/
│   ├── server.log      # Логи backend сервера
│   ├── frontend.log    # Логи frontend сервера
│   ├── server.pid      # PID backend процесса
│   └── frontend.pid    # PID frontend процесса
├── start-servers.sh    # Скрипт запуска
├── stop-servers.sh     # Скрипт остановки
├── status-servers.sh   # Скрипт проверки статуса
├── restart-servers.sh  # Скрипт перезапуска
├── fix-posts-progress.sh # Диагностика проблем с постами
└── fix-progress.sh     # Исправление прогресса задач
```

## Порты

- **3000** - Frontend (Vite dev server)
- **5000** - Backend (Express API server)

## Логи

Все логи сохраняются в директории `logs/`:
- `server.log` - логи backend сервера
- `frontend.log` - логи frontend сервера

Для просмотра логов в реальном времени:
```bash
# Логи сервера
tail -f logs/server.log

# Логи фронтенда
tail -f logs/frontend.log
```

## Устранение неполадок

### Сервер не запускается
1. Проверьте, что Node.js и npm установлены
2. Убедитесь, что порты 3000 и 5000 свободны
3. Проверьте логи в директории `logs/`

### Процессы зависли
```bash
# Принудительная остановка всех процессов
./stop-servers.sh

# Или вручную
lsof -ti:3000 | xargs kill -9
lsof -ti:5000 | xargs kill -9
```

### Проблемы с зависимостями
```bash
# Переустановка зависимостей
cd server && rm -rf node_modules && npm install
cd ../front && rm -rf node_modules && npm install
```

## Автоматический запуск при загрузке системы

Для автоматического запуска серверов при загрузке системы можно создать systemd сервис:

1. Создайте файл `/etc/systemd/system/reposter.service`:
```ini
[Unit]
Description=Reposter Application
After=network.target

[Service]
Type=forking
User=your-username
WorkingDirectory=/path/to/reposter_2
ExecStart=/path/to/reposter_2/start-servers.sh
ExecStop=/path/to/reposter_2/stop-servers.sh
Restart=always

[Install]
WantedBy=multi-user.target
```

2. Активируйте сервис:
```bash
sudo systemctl enable reposter.service
sudo systemctl start reposter.service
```

## Требования

- Linux/Unix система
- Node.js (версия 14 или выше)
- npm
- Bash shell
- Утилиты: `lsof`, `curl`, `ps`

## Безопасность

- Скрипты работают только с локальными портами
- Все процессы запускаются от имени текущего пользователя
- PID файлы содержат только идентификаторы процессов
- Логи не содержат чувствительной информации 